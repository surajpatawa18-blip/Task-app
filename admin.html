<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f2f2f2}
.header{background:#ff6a00;color:white;padding:15px;font-size:20px}
.section{background:white;margin:12px;padding:12px;border-radius:10px}
button{padding:8px 14px;border:none;border-radius:6px;background:#ff6a00;color:white}
input{width:100%;padding:8px;margin:6px 0}
hr{border:none;border-top:1px solid #eee;margin:10px 0}
.approve{background:green}
.reject{background:red}
</style>
</head>

<body>

<div class="header">ðŸ”¥ Admin Panel</div>

<!-- LOGIN -->
<div class="section" id="loginBox">
 <h3>Admin Login</h3>
 <input id="adminEmail" placeholder="Admin Email">
 <input id="adminPass" type="password" placeholder="Password">
 <button onclick="adminLogin()">Login</button>
</div>

<!-- PANEL -->
<div id="panel" style="display:none">

<!-- MANUAL COIN ADD -->
<div class="section">
 <h3>âž• Add Coins Manually</h3>
 <input id="uidInput" placeholder="User UID">
 <input id="coinInput" placeholder="Coins Amount">
 <button onclick="addCoins()">Add Coins</button>
</div>

<!-- PAYMENT APPROVAL -->
<div class="section">
 <h3>ðŸ’³ â‚¹1299 Payments</h3>
 <div id="paymentList">Loading...</div>
</div>

<!-- DEPOSIT APPROVAL -->
<div class="section">
 <h3>ðŸ’° Deposits</h3>
 <div id="depositList">Loading...</div>
</div>

<!-- WITHDRAW REQUESTS -->
<div class="section">
 <h3>ðŸ’¸ Withdraw Requests</h3>
 <div id="withdrawList">Loading...</div>
</div>

<button style="margin:12px" onclick="logout()">Logout</button>

</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyArCdfGSLZQi8CBbw7is71kxB5036Wlj5E",
 authDomain:"calling-98df6.firebaseapp.com",
 databaseURL:"https://calling-98df6-default-rtdb.firebaseio.com",
 projectId:"calling-98df6",
 appId:"1:421742710154:web:8ac1621ab81b45edd2cc73"
});

const auth=firebase.auth();
const db=firebase.database();

/* ADMIN LOGIN */
function adminLogin(){
 auth.signInWithEmailAndPassword(adminEmail.value,adminPass.value)
 .then(()=>{
  loginBox.style.display="none";
  panel.style.display="block";
  loadPayments();
  loadDeposits();
  loadWithdraws();
 })
 .catch(e=>alert(e.message));
}

/* LOGOUT */
function logout(){
 auth.signOut();
 location.reload();
}

/* MANUAL COIN ADD */
function addCoins(){
 const uid=uidInput.value.trim();
 const amt=parseInt(coinInput.value);
 if(!uid || !amt) return alert("Fill all fields");

 db.ref("users/"+uid+"/coins").transaction(c=>(c||0)+amt);
 alert("Coins added");
}

/* PAYMENT APPROVE (â‚¹1299) */
function loadPayments(){
 db.ref("payments").on("value",snap=>{
  let html="";
  snap.forEach(s=>{
   const p=s.val();
   if(p.status==="pending"){
    html+=`
     <div>
      UID: ${p.uid}<br>
      UTR: ${p.utr}<br>
      <button class="approve" onclick="approvePayment('${s.key}','${p.uid}')">Approve</button>
     </div><hr>
    `;
   }
  });
  paymentList.innerHTML=html||"No pending payments";
 });
}

function approvePayment(pid,uid){
 db.ref("payments/"+pid+"/status").set("approved");
 db.ref("users/"+uid+"/paid").set(true);
 alert("Payment approved");
}

/* DEPOSIT APPROVE + AUTO COIN ADD */
function loadDeposits(){
 db.ref("deposits").on("value",snap=>{
  let html="";
  snap.forEach(s=>{
   const d=s.val();
   if(d.status==="pending"){
    html+=`
     <div>
      UID: ${d.uid}<br>
      Amount: â‚¹${d.amount}<br>
      UTR: ${d.utr}<br>
      <button class="approve"
       onclick="approveDeposit('${s.key}','${d.uid}',${d.amount})">
       Approve
      </button>
     </div><hr>
    `;
   }
  });
  depositList.innerHTML=html||"No pending deposits";
 });
}

function approveDeposit(id,uid,amt){
 db.ref("deposits/"+id+"/status").set("approved");
 db.ref("users/"+uid+"/coins").transaction(c=>(c||0)+amt);
 alert("Deposit approved & coins added");
}

/* WITHDRAW */
function loadWithdraws(){
 db.ref("withdrawals").on("value",snap=>{
  let html="";
  snap.forEach(s=>{
   const w=s.val();
   if(w.status==="pending"){
    html+=`
     <div>
      UID: ${w.uid}<br>
      Amount: â‚¹${w.amount}<br>
      ${w.name}<br>
      ${w.upi} | ${w.mobile}<br>
      <button class="approve"
       onclick="approveWithdraw('${s.key}')">
       Mark Paid
      </button>
     </div><hr>
    `;
   }
  });
  withdrawList.innerHTML=html||"No pending withdrawals";
 });
}

function approveWithdraw(id){
 db.ref("withdrawals/"+id+"/status").set("paid");
 alert("Withdraw marked paid");
}
</script>
</body>
</html>
