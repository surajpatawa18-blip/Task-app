<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Earn Money App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDK v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root{--o:#ff6a00}
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#f2f2f2}
.app{min-height:100vh;background:#fff}
.header{
 background:var(--o);color:#fff;
 padding:14px 16px;font-size:18px;
 display:flex;justify-content:space-between;align-items:center
}
.screen{display:none}
.show{display:block}
.wallet{
 margin:16px;padding:20px;border-radius:16px;
 background:linear-gradient(135deg,#ff6a00,#ff944d);
 color:#fff;text-align:center
}
button{
 width:90%;margin:10px auto;padding:12px;
 border:none;border-radius:10px;
 background:var(--o);color:#fff;font-weight:bold;display:block
}
input{
 width:100%;padding:12px;margin-top:10px;
 border:1px solid #ddd;border-radius:10px
}
.list{padding:10px}
.row{
 background:#fff;margin-bottom:8px;padding:10px;
 border-radius:8px;display:flex;justify-content:space-between
}
</style>
</head>

<body>
<div class="app">

<!-- LOGIN -->
<div class="screen show" id="loginScreen">
 <div class="header">Login / Signup</div>
 <div style="padding:20px">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <input id="refInput" placeholder="Referral Code (optional)">
  <button onclick="login()">Login</button>
  <button onclick="signup()">Signup</button>
 </div>
</div>

<!-- üîí PAID UNLOCK -->
<div class="screen" id="unlockScreen">
 <div class="header">Activate Pro</div>
 <div style="padding:20px;text-align:center">
  <h2>‚Çπ1299 One-Time Payment</h2>
  <img src="qr.png" style="width:220px;border-radius:12px">
  <input id="utrInput" placeholder="Enter UTR Number">
  <button onclick="submitDeposit()">Submit Payment</button>
  <p style="font-size:13px;color:#777">Approval ke baad unlock hoga</p>
 </div>
</div>

<!-- DASHBOARD -->
<div class="screen" id="dashboardScreen">
 <div class="header">Dashboard</div>

 <div class="wallet">
  <div>Balance</div>
  <h1>‚Çπ <span id="coins">0</span></h1>
 </div>

 <button onclick="openSpin()">üé° Spin</button>
 <button onclick="openRefer()">üë• Refer</button>
 <button onclick="openLeaderboard()">üèÜ Leaderboard</button>
 <button onclick="openWithdraw()">üí∏ Withdraw</button>
 <button onclick="logout()">Logout</button>
</div>

<!-- SPIN -->
<div class="screen" id="spinScreen">
 <div class="header">Spin</div>
 <div style="text-align:center">
  <div id="wheel" style="
   width:240px;height:240px;margin:20px auto;border-radius:50%;
   border:8px solid #ff6a00;
   background:conic-gradient(#ffd000 0 45deg,#ff6a00 45 90deg,
   #ffd000 90 135deg,#ff6a00 135 180deg,
   #ffd000 180 225deg,#ff6a00 225 270deg,
   #ffd000 270 315deg,#ff6a00 315 360deg);
   transition:transform 6s ease-out
  "></div>
  <button onclick="spin()">SPIN NOW</button>
  <button onclick="openDashboard()">Back</button>
 </div>
</div>

<!-- REFER -->
<div class="screen" id="referScreen">
 <div class="header">Refer & Earn</div>
 <div style="padding:20px">
  <input id="myRef" readonly>
  <input id="refLink" readonly>
  <button onclick="copyRef()">Copy Link</button>
  <p>‚Çπ3 per referral</p>
 </div>
</div>

<!-- LEADERBOARD -->
<div class="screen" id="leaderScreen">
 <div class="header">Leaderboard</div>
 <div class="list" id="leaderList"></div>
 <button onclick="openDashboard()">Back</button>
</div>

<!-- WITHDRAW -->
<div class="screen" id="withdrawScreen">
 <div class="header">Withdraw</div>
 <input id="wdAmount" placeholder="Min ‚Çπ20">
 <button onclick="withdraw()">Request Withdraw</button>
 <button onclick="openDashboard()">Back</button>
</div>

</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyArCdfGSLZQi8CBbw7is71kxB5036Wlj5E",
 authDomain:"calling-98df6.firebaseapp.com",
 databaseURL:"https://calling-98df6-default-rtdb.firebaseio.com",
 projectId:"calling-98df6"
});

const auth=firebase.auth(), db=firebase.database();
let uid=null;

/* GET REF FROM LINK */
const params=new URLSearchParams(window.location.search);
const refFromLink=params.get("ref");

/* AUTH */
auth.onAuthStateChanged(u=>{
 if(!u){show("loginScreen");return;}
 uid=u.uid;
 db.ref("users/"+uid+"/paid").once("value",s=>{
  if(s.val()===true){show("dashboardScreen");loadUser();loadLeaderboard();}
  else show("unlockScreen");
 });
});

function show(id){
 document.querySelectorAll(".screen").forEach(s=>s.classList.remove("show"));
 document.getElementById(id).classList.add("show");
}

/* NAV */
const openDashboard=()=>show("dashboardScreen");
const openSpin=()=>show("spinScreen");
const openRefer=()=>show("referScreen");
const openLeaderboard=()=>show("leaderScreen");
const openWithdraw=()=>show("withdrawScreen");

/* LOGIN / SIGNUP */
function login(){
 auth.signInWithEmailAndPassword(email.value,password.value);
}
function signup(){
 auth.createUserWithEmailAndPassword(email.value,password.value)
 .then(r=>{
  const code=r.user.uid.slice(0,6).toUpperCase();
  db.ref("users/"+r.user.uid).set({
   coins:0,paid:false,
   referralCode:code,
   referralCount:0,
   referredBy:refFromLink||"",
   lastSpinDate:"",
   lastWithdrawDate:""
  });

  if(refFromLink) rewardReferrer(refFromLink);
 });
}

/* USER */
function loadUser(){
 db.ref("users/"+uid).on("value",s=>{
  coins.innerText=s.val().coins||0;
  myRef.value=s.val().referralCode;
  refLink.value=location.origin+location.pathname+"?ref="+s.val().referralCode;
 });
}

/* REFERRAL REWARD */
function rewardReferrer(code){
 db.ref("users").once("value",snap=>{
  snap.forEach(u=>{
   if(u.val().referralCode===code){
    db.ref("users/"+u.key).update({
     coins:(u.val().coins||0)+3,
     referralCount:(u.val().referralCount||0)+1
    });
   }
  });
 });
}
function copyRef(){
 navigator.clipboard.writeText(refLink.value);
 alert("Referral link copied");
}

/* LEADERBOARD */
function loadLeaderboard(){
 db.ref("users").orderByChild("referralCount").limitToLast(10)
 .on("value",snap=>{
  leaderList.innerHTML="";
  snap.forEach(u=>{
   leaderList.innerHTML=
    `<div class="row">
      <span>${u.val().referralCode}</span>
      <b>${u.val().referralCount||0}</b>
     </div>`+leaderList.innerHTML;
  });
 });
}

/* SPIN */
function spin(){
 const today=new Date().toDateString();
 const r=db.ref("users/"+uid);
 r.once("value",s=>{
  if(s.val().lastSpinDate===today){alert("Aaj spin ho chuka");return;}
  const win=Math.floor(Math.random()*8)+1;
  wheel.style.transform=`rotate(${360*5+45*(win-1)}deg)`;
  setTimeout(()=>{
   r.update({coins:s.val().coins+win,lastSpinDate:today});
   alert("You won ‚Çπ"+win);
  },6000);
 });
}

/* WITHDRAW */
function withdraw(){
 const amt=parseInt(wdAmount.value);
 if(amt<20)return alert("Min ‚Çπ20");
 const r=db.ref("users/"+uid);
 r.once("value",s=>{
  if(s.val().coins<amt)return alert("Low balance");
  if(s.val().lastWithdrawDate===new Date().toDateString())
   return alert("Aaj already withdraw");
  r.update({
   coins:s.val().coins-amt,
   lastWithdrawDate:new Date().toDateString()
  });
  db.ref("withdrawals").push({uid,amount:amt,status:"pending"});
  alert("Withdraw requested");
 });
}

/* DEPOSIT (ANTI-SPAM) */
function submitDeposit(){
 const utr=utrInput.value.trim();
 if(utr.length<8)return alert("Valid UTR");
 db.ref("utrUsed/"+utr).once("value",u=>{
  if(u.exists())return alert("UTR already used");
  db.ref("deposits").push({uid,utr,amount:1299,status:"pending"});
  db.ref("utrUsed/"+utr).set(true);
  alert("Payment submitted");
 });
}

function logout(){auth.signOut()}
</script>

</body>
</html>
