<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Earn Money App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDK v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root{--o:#ff6a00}
*{box-sizing:border-box;font-family:Arial}
body{margin:0;height:100vh;background:#f2f2f2}
.app{height:100vh;background:white;display:flex;flex-direction:column}

.header{
 height:56px;background:var(--o);color:white;
 display:flex;align-items:center;justify-content:space-between;
 padding:0 16px;font-size:18px
}
.dots{font-size:26px;cursor:pointer}

.screen{display:none;flex:1;overflow:auto}
.show{display:block}

.wallet{
 margin:16px;
 background:linear-gradient(135deg,#ff6a00,#ff944d);
 color:white;padding:20px;border-radius:16px;text-align:center
}

button{
 width:90%;margin:10px auto;padding:12px;
 border:none;border-radius:10px;
 background:var(--o);color:white;font-weight:bold;display:block
}
input{
 width:100%;padding:12px;margin-top:12px;
 border:1px solid #ddd;border-radius:10px
}

.menuPanel{
 position:fixed;bottom:-100%;left:0;width:100%;
 background:white;border-radius:20px 20px 0 0;
 box-shadow:0 -5px 20px rgba(0,0,0,.2);
 transition:.3s;padding:20px
}
.menuPanel.showMenu{bottom:0}
.menuItem{padding:15px;border-bottom:1px solid #eee;font-size:16px}
</style>
</head>

<body>
<div class="app">

<!-- LOGIN -->
<div class="screen show" id="loginScreen">
 <div class="header">Login / Signup</div>
 <div style="padding:20px">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <input id="refInput" placeholder="Referral Code (optional)">
  <button onclick="login()">Login</button>
  <button onclick="signup()">Signup</button>
 </div>
</div>

<!-- üîí PRO UNLOCK SCREEN -->
<div class="screen" id="unlockScreen">
 <div class="header">Activate Pro</div>
 <div style="padding:20px;text-align:center">
  <h2>‚Çπ1299 One-Time Payment</h2>

  <p>Scan & Pay</p>
  <!-- QR CODE IMAGE -->
  <img src="qr.png" style="
   width:220px;
   margin:15px auto;
   display:block;
   border-radius:12px;
   box-shadow:0 5px 15px rgba(0,0,0,.2)
  ">

  <p>UPI ID: <b>yourupi@bank</b></p>

  <input id="utrInput" placeholder="Enter UTR Number">
  <button onclick="submitDeposit()">Submit Payment</button>

  <p style="font-size:13px;color:#777">
   Approval ke baad app unlock hoga
  </p>
 </div>
</div>

<!-- DASHBOARD -->
<div class="screen" id="dashboardScreen">
 <div class="header">
  <span>Dashboard</span>
  <span class="dots" onclick="toggleMenu()">‚ãÆ</span>
 </div>

 <div class="wallet">
  <div>Balance</div>
  <h1>‚Çπ <span id="coins">0</span></h1>
 </div>
</div>

</div>

<script>
/* FIREBASE CONFIG */
firebase.initializeApp({
 apiKey:"AIzaSyArCdfGSLZQi8CBbw7is71kxB5036Wlj5E",
 authDomain:"calling-98df6.firebaseapp.com",
 databaseURL:"https://calling-98df6-default-rtdb.firebaseio.com",
 projectId:"calling-98df6"
});

const auth = firebase.auth();
const db = firebase.database();
let uid = null;

/* AUTH STATE */
auth.onAuthStateChanged(u=>{
 if(!u){
  showScreen("loginScreen");
  return;
 }
 uid = u.uid;

 db.ref("users/"+uid+"/paid").once("value",snap=>{
  if(snap.val() === true){
   showScreen("dashboardScreen");
   loadUser();
  }else{
   showScreen("unlockScreen");
  }
 });
});

function showScreen(id){
 document.querySelectorAll(".screen").forEach(s=>s.classList.remove("show"));
 document.getElementById(id).classList.add("show");
}

/* LOGIN */
function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .catch(e=>alert(e.message));
}

/* SIGNUP */
function signup(){
 auth.createUserWithEmailAndPassword(email.value,password.value)
 .then(r=>{
  const code = r.user.uid.slice(0,6).toUpperCase();
  db.ref("users/"+r.user.uid).set({
   coins:0,
   referralCode:code,
   lastSpinDate:"",
   lastWithdrawDate:"",
   paid:false
  });
 });
}

/* USER DATA */
function loadUser(){
 db.ref("users/"+uid).on("value",snap=>{
  coins.innerText = snap.val().coins || 0;
 });
}

/* üîí ANTI-SPAM DEPOSIT SUBMIT */
function submitDeposit(){
 const utr = utrInput.value.trim();
 if(utr.length < 8){
  alert("Valid UTR enter karo");
  return;
 }

 // 1Ô∏è‚É£ Same UTR reuse block
 db.ref("utrUsed/"+utr).once("value",uSnap=>{
  if(uSnap.exists()){
   alert("‚ùå Ye UTR already use ho chuka hai");
   return;
  }

  // 2Ô∏è‚É£ One pending deposit per user
  db.ref("deposits").orderByChild("uid").equalTo(uid)
  .once("value",snap=>{
   let pending=false;
   snap.forEach(d=>{
    if(d.val().status==="pending") pending=true;
   });

   if(pending){
    alert("‚ùå Aapka ek deposit already pending hai");
    return;
   }

   // ‚úÖ Allow deposit
   db.ref("deposits").push({
    uid:uid,
    utr:utr,
    amount:1299,
    status:"pending",
    time:Date.now()
   });

   db.ref("utrUsed/"+utr).set(true);

   alert("‚úÖ Payment submitted. Approval pending.");
  });
 });
}

/* üîí DAILY WITHDRAW LIMIT */
function withdraw(){
 const amt = parseInt(wdAmount.value);
 if(amt < 20){
  alert("Min ‚Çπ20");
  return;
 }

 const today = new Date().toDateString();
 const r = db.ref("users/"+uid);

 r.once("value",snap=>{
  const d = snap.val();

  if(d.lastWithdrawDate === today){
   alert("‚ùå Aaj already withdrawal request kar chuke ho");
   return;
  }

  if(d.coins < amt){
   alert("Low balance");
   return;
  }

  r.update({
   coins: d.coins - amt,
   lastWithdrawDate: today
  });

  db.ref("withdrawals").push({
   uid:uid,
   amount:amt,
   status:"pending",
   time:Date.now()
  });

  alert("Withdrawal request sent");
 });
}

/* MENU */
function toggleMenu(){menuPanel.classList.toggle("showMenu")}
function logout(){auth.signOut()}
</script>

</body>
</html>
